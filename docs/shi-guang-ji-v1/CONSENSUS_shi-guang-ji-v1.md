# 拾光集 v1.0 - 共识文档 (CONSENSUS)

**任务名称:** shi-guang-ji-v1  
**创建日期:** 2025-09-06  
**阶段:** Phase 1 - Align (Final)  
**基于文档:** ALIGNMENT_shi-guang-ji-v1.md

---

## 1. 明确的需求描述

### 1.1 项目目标
构建"拾光集" v1.0 - 一个跨平台的个人生活记录Web应用，帮助用户记录日常生活、管理个人媒体，并提供美观流畅的用户体验。

### 1.2 核心用户价值
- **记录习惯培养:** 通过每日打卡和日记功能帮助用户建立记录习惯
- **媒体管理:** 提供便捷的照片和视频管理功能
- **跨设备同步:** 确保用户在手机和电脑上的数据一致性
- **隐私安全:** 保障用户个人数据的安全和隐私

---

## 2. 技术实现方案

### 2.1 确定的技术栈
- **前端框架:** Next.js 14 (App Router)
- **UI库:** Shadcn/ui + Tailwind CSS
- **富文本编辑器:** TipTap (基于ProseMirror)
- **后端服务:** Supabase (PostgreSQL + Auth + Storage)
- **部署平台:** Vercel
- **开发语言:** TypeScript (严格模式)
- **包管理器:** pnpm
- **状态管理:** Zustand (轻量级状态管理)

### 2.2 技术选型理由
1. **Next.js 14:** 
   - Vercel原生支持，最佳性能优化
   - App Router提供更好的开发体验
   - 强大的SSR/SSG能力

2. **Shadcn/ui:**
   - 现代化组件库，优秀的TypeScript支持
   - 高度可定制，符合设计要求
   - 活跃的社区和文档

3. **TipTap:**
   - 成熟的富文本编辑器，React集成良好
   - 支持Markdown双向绑定
   - 移动端优化良好

4. **Supabase:**
   - 开源Firebase替代品
   - 内置RLS安全策略
   - 完整的后端服务套件

---

## 3. 系统架构概述

### 3.1 整体架构
```
用户设备 (浏览器)
    ↓ HTTPS
Vercel (Next.js应用)
    ↓ Supabase SDK
Supabase 后端服务
    ├── PostgreSQL (数据存储)
    ├── Auth (用户认证)
    └── Storage (文件存储)
```

### 3.2 数据库设计
- **profiles:** 用户资料信息
- **check_ins:** 每日打卡记录
- **diaries:** 日记内容
- **media:** 媒体文件元数据
- **tags:** 标签系统
- **diary_tags:** 日记标签关联

---

## 4. 功能模块定义

### 4.1 核心模块 (P0 - 必须实现)

#### 4.1.1 用户认证模块
**功能范围:**
- 邮箱注册/登录
- 密码重置
- 用户资料管理 (头像、昵称、简介)

**验收标准:**
- 用户可以通过邮箱成功注册账户
- 用户可以登录/登出
- 用户可以修改个人资料
- 所有认证流程有适当的错误处理

#### 4.1.2 每日打卡模块
**功能范围:**
- 每日一次打卡功能
- 心情标签选择 (开心、平静、疲惫、兴奋等)
- 一句话小记 (可选，最多100字)
- 打卡历史日历展示

**验收标准:**
- 用户每天只能打卡一次
- 打卡记录正确保存和展示
- 日历视图清晰显示打卡历史
- 支持查看历史打卡详情

#### 4.1.3 日记系统模块
**功能范围:**
- 富文本日记编辑器 (Markdown支持)
- 图片/视频插入功能
- 草稿自动保存
- 日记列表和详情查看
- 日记编辑和删除

**验收标准:**
- 编辑器支持基本Markdown语法
- 可以插入和预览图片/视频
- 草稿每30秒自动保存
- 日记列表按时间倒序排列
- 编辑和删除功能正常工作

#### 4.1.4 媒体库模块
**功能范围:**
- 照片/视频批量上传
- 时间线视图和网格视图
- 按年/月/日快速跳转
- 全屏预览功能
- 基本的EXIF信息显示

**验收标准:**
- 支持常见图片格式 (JPG, PNG, WebP)
- 支持常见视频格式 (MP4, WebM)
- 上传进度显示和错误处理
- 视图切换流畅
- 预览功能正常工作

### 4.2 增强模块 (P1 - 时间允许时实现)
- "那年今日"功能
- 标签系统
- 基础数据导出

---

## 5. 技术约束和集成方案

### 5.1 性能约束
- 首屏加载时间 < 2秒
- 图片懒加载和压缩
- 代码分割和按需加载
- 合理的缓存策略

### 5.2 安全约束
- 所有数据表启用RLS策略
- 环境变量管理敏感信息
- HTTPS强制使用
- 文件上传安全检查

### 5.3 兼容性约束
- 响应式设计 (320px - 1920px)
- 现代浏览器支持 (Chrome 90+, Safari 14+, Firefox 88+)
- 移动端触摸优化

---

## 6. 验收标准

### 6.1 功能验收标准
- [ ] **用户认证:** 完整的注册/登录/资料管理流程
- [ ] **每日打卡:** 打卡功能和历史查看正常工作
- [ ] **日记系统:** 创建/编辑/删除/查看日记功能完整
- [ ] **媒体库:** 上传/浏览/管理媒体文件功能正常
- [ ] **响应式:** 在桌面端和移动端都有良好体验

### 6.2 技术验收标准
- [ ] **代码质量:** TypeScript严格模式，ESLint/Prettier规范
- [ ] **安全性:** RLS策略配置，环境变量管理
- [ ] **性能:** 核心Web Vitals指标良好
- [ ] **部署:** 成功部署到Vercel并正常运行
- [ ] **测试:** 关键功能有基本的单元测试

### 6.3 用户体验验收标准
- [ ] **界面美观:** 符合"拾光"主题的设计风格
- [ ] **交互流畅:** 无明显卡顿，加载状态清晰
- [ ] **错误处理:** 友好的错误提示和处理
- [ ] **数据安全:** 用户数据正确保存和同步

---

## 7. 项目边界和限制

### 7.1 明确包含
- 完整的Web应用实现
- 核心功能模块 (P0)
- 基础的测试覆盖
- 部署配置和文档

### 7.2 明确不包含
- 原生移动应用
- 第三方登录 (微信、Apple ID)
- 高级搜索功能
- 多语言支持
- 复杂的数据分析

### 7.3 技术限制
- Supabase免费层限制
- Vercel免费层限制
- 不使用付费第三方服务

---

## 8. 下一步行动

1. ✅ 完成需求对齐和共识确认
2. 🔄 进入Phase 2: Architect - 创建详细的系统架构设计
3. ⏳ 后续阶段按6A方法论依次执行

---

**共识确认:** 本文档代表了对"拾光集" v1.0项目的最终需求理解和技术方案共识。所有不确定性已解决，可以进入架构设计阶段。
