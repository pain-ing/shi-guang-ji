# 拾光集 (Shi Guang Ji) - 技术架构文档

**版本:** 1.0
**日期:** 2025年9月7日
**作者:** [你的名字]

---

### 1. 概述

本文档旨在定义 "拾光集" 应用的技术选型、系统架构和部署策略，以满足产品需求文档中定义的功能性和非功能性需求。我们将采用现代化的 Jamstack 架构，利用 Vercel 和 Supabase 的强大功能，实现快速开发、部署和扩展。

---

### 2. 系统架构图

+----------------+      +------------------+      +----------------------+
|   用户 (手机/电脑) | ---> |  Vercel (前端托管) | ---> | Supabase (后端即服务) |
+----------------+      +------------------+      +----------------------+
|                      | (Next.js/Vue)         |  - PostgreSQL 数据库 |
|                      |                       |  - 用户认证 (Auth)   |
|                      |                       |  - 文件存储 (Storage)|
|                      +---------------------> |  - Serverless 函数  |
|                                              +----------------------+
|
+---------------------------------------------------------------------> (直接上传)

* **前端 (Frontend):** 部署在 Vercel 上的 Web 应用。
* **后端 (Backend):** 使用 Supabase 提供的一体化后端服务。
* **数据流:**
    1.  用户通过浏览器或移动端 App (Web View封装) 访问部署在 Vercel 上的前端应用。
    2.  前端应用通过 Supabase 的客户端 SDK 与后端进行交互。
    3.  用户认证、数据读写请求直接发送到 Supabase Auth 和数据库。
    4.  图片、视频等大文件，通过 Supabase Storage 服务进行上传和管理。

---

### 3. 技术选型

| 领域       | 技术/服务                                                               | 理由                                                                                                                  |
| :--------- | :---------------------------------------------------------------------- | :-------------------------------------------------------------------------------------------------------------------- |
| **前端框架** | **Next.js (React)** 或 **Nuxt.js (Vue)** | 提供强大的 SSR (服务端渲染) 和 SSG (静态站点生成) 能力，有利于SEO和首屏加载速度。Vercel 对其提供原生支持和最佳优化。 |
| **UI 库** | **Tailwind CSS** + **Headless UI** 或 **Shadcn/ui** | 提供高度可定制化的原子级 CSS，便于构建美观且一致的界面，同时保持高性能。                                          |
| **后端服务** | **Supabase** | 开源的 Firebase 替代品，提供 PostgreSQL 数据库、认证、对象存储、Serverless 函数等全套后端功能，上手快，扩展性强。 |
| **数据库** | **PostgreSQL (由 Supabase 提供)** | 功能强大、稳定可靠的关系型数据库，足以应对项目初期的各种数据存储需求。                                                  |
| **文件存储** | **Supabase Storage** | 用于存储用户上传的照片和视频，提供权限管理，与数据库和认证系统深度集成。                                              |
| **前端部署** | **Vercel** | 与 Next.js/Nuxt.js 完美集成，提供 CI/CD、全球CDN、预览部署等功能，极大简化了前端部署和运维流程。               |
| **移动端** | **Capacitor** 或 **Tauri** (封装Web应用)                                | (可选) 如果需要发布到应用商店，可以使用这些工具将Web应用打包成原生 App，实现跨平台，并能访问原生设备API。             |

---

### 4. 数据库设计 (Supabase PostgreSQL)

#### 4.1 `users` 表 (由 Supabase Auth 自动管理)
* `id` (uuid, 主键)
* `email` (varchar)
* ... (其他认证信息)

#### 4.2 `profiles` 表 (存储用户公开信息)
* `id` (uuid, 主键, 关联 `users.id`)
* `username` (varchar, 昵称)
* `avatar_url` (text, 头像链接)
* `bio` (text, 简介)
* `created_at` (timestamp with time zone)

#### 4.3 `check_ins` 表 (每日打卡)
* `id` (bigint, 主键)
* `user_id` (uuid, 外键 -> `users.id`)
* `mood` (varchar, 心情标签)
* `note` (text, 一句话小记)
* `created_at` (date, 记录日期，用于确保一天只打一次卡)

#### 4.4 `diaries` 表 (日记)
* `id` (bigint, 主键)
* `user_id` (uuid, 外键 -> `users.id`)
* `title` (text)
* `content` (text, Markdown格式)
* `created_at` (timestamp with time zone)
* `updated_at` (timestamp with time zone)

#### 4.5 `media` 表 (媒体文件)
* `id` (bigint, 主键)
* `user_id` (uuid, 外键 -> `users.id`)
* `file_path` (text, 在 Supabase Storage 中的路径)
* `file_type` (varchar, 'image' 或 'video')
* `created_at` (timestamp with time zone)

#### 4.6 `tags` 和 `diary_tags` 表 (标签，多对多关系)
* `tags`: `id`, `name`
* `diary_tags`: `diary_id`, `tag_id`

---

### 5. 安全考虑

* **行级安全 (RLS - Row Level Security):** 必须在 Supabase 中为所有表启用 RLS 策略，确保用户只能访问和修改自己的数据。
* **环境变量:** Supabase 的 `anon key` 和 `service_role key` 等敏感信息必须通过 Vercel 的环境变量进行管理，绝不能硬编码在前端代码中。
* **文件访问:** Supabase Storage 中的文件桶 (Bucket) 应设置为私有，通过生成带有时效性的签名 URL 来授权用户访问。

---