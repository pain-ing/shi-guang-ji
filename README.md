# æ‹¾å…‰é›† - åŸºäº 6A å®‰å…¨æ¡†æ¶çš„ä¸ªäººæ—¥è®°åº”ç”¨

ä¸€ä¸ªç°ä»£åŒ–çš„ä¸ªäººæ—¥è®°åº”ç”¨ï¼Œé‡‡ç”¨ Next.js 14 + Supabase æ„å»ºï¼Œå®ç°äº†å®Œæ•´çš„ 6A å®‰å…¨æ¡†æ¶ã€‚

## ğŸ”’ 6A å®‰å…¨æ¡†æ¶å®ç°

### 1. Authentication (è®¤è¯)
- **å¼ºå¯†ç ç­–ç•¥**ï¼š10ä½ä»¥ä¸Šï¼ŒåŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—ã€ç‰¹æ®Šå­—ç¬¦
- **é‚®ç®±éªŒè¯**ï¼šæ³¨å†Œå¿…é¡»é€šè¿‡é‚®ç®±éªŒè¯æ¿€æ´»
- **å¸¸è§å¼±å¯†ç é»‘åå•**ï¼šé˜²æ­¢ä½¿ç”¨å¸¸è§å¼±å¯†ç 
- **å®¡è®¡æ—¥å¿—**ï¼šæ‰€æœ‰è®¤è¯äº‹ä»¶å®Œæ•´è®°å½•

### 2. Authorization (æˆæƒ)
- **åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ (RBAC)**ï¼šadmin/user è§’è‰²ä½“ç³»
- **è¡Œçº§å®‰å…¨ (RLS)**ï¼šç”¨æˆ·ä»…èƒ½è®¿é—®è‡ªå·±çš„æ•°æ®
- **ç®¡ç†å‘˜æƒé™**ï¼šç®¡ç†å‘˜å¯è®¿é—®å…¨é‡å®¡è®¡æ—¥å¿—å’Œç”¨æˆ·ç®¡ç†

### 3. Accounting (å®¡è®¡)
- **å®Œæ•´å®¡è®¡é“¾**ï¼šSHA-256 å“ˆå¸Œé“¾ç¡®ä¿æ—¥å¿—ä¸å¯ç¯¡æ”¹
- **äº‹ä»¶è¦†ç›–**ï¼šæ³¨å†Œã€ç™»å½•ã€ç™»å‡ºã€è§’è‰²å˜æ›´ç­‰å…³é”®äº‹ä»¶
- **IP/UA è¿½è¸ª**ï¼šè®°å½•ç”¨æˆ·è¡Œä¸ºçš„ç½‘ç»œç¯å¢ƒä¿¡æ¯

### 4. Administration (ç®¡ç†)
- **ç”¨æˆ·ç®¡ç†ç•Œé¢**ï¼š/admin ç®¡ç†å‘˜æ§åˆ¶å°
- **è§’è‰²åˆ‡æ¢**ï¼šä¸€é”®åˆ‡æ¢ç”¨æˆ· admin/user è§’è‰²
- **å®¡è®¡æ—¥å¿—æµè§ˆ**ï¼šå®æ—¶æŸ¥çœ‹ç³»ç»Ÿå®‰å…¨äº‹ä»¶

### 5. Audit (ç¨½æ ¸)
- **ä¸å¯æŠµèµ–æ—¥å¿—**ï¼šaudit_logs è¡¨ç¦æ­¢æ›´æ–°/åˆ é™¤
- **å“ˆå¸Œé“¾æ ¡éªŒ**ï¼šæ¯æ¡è®°å½•åŒ…å«å‰åºå“ˆå¸Œï¼Œç¡®ä¿å®Œæ•´æ€§
- **æ—¶é—´æˆ³ä¿æŠ¤**ï¼šä½¿ç”¨æ•°æ®åº“æ—¶é—´æˆ³é˜²æ­¢æ—¶é—´ç¯¡æ”¹

### 6. Anti-repudiation (æŠ—æŠµèµ–)
- **æ•°å­—ç­¾åæœºåˆ¶**ï¼šåŸºäº SHA-256 çš„å“ˆå¸Œé“¾
- **æ“ä½œä¸å¯å¦è®¤**ï¼šæ‰€æœ‰å…³é”®æ“ä½œå‡æœ‰å®¡è®¡è®°å½•
- **å®Œæ•´æ€§éªŒè¯**ï¼šæ”¯æŒå®¡è®¡é“¾å®Œæ•´æ€§è‡ªæ£€

## ğŸš€ æŠ€æœ¯æ ˆ

- **å‰ç«¯**: Next.js 14 (App Router), React, TypeScript, Tailwind CSS
- **åç«¯**: Next.js API Routes, Supabase
- **æ•°æ®åº“**: PostgreSQL (Supabase)
- **è®¤è¯**: Supabase Auth + è‡ªå®šä¹‰å®‰å…¨å¢å¼º
- **çŠ¶æ€ç®¡ç†**: Zustand
- **è¡¨å•éªŒè¯**: Zod

## ğŸ›¡ï¸ å®‰å…¨ç‰¹æ€§

### ä¼šè¯ç®¡ç†
- **ç©ºé—²è¶…æ—¶**: 30åˆ†é’Ÿæ— æ“ä½œè‡ªåŠ¨ç™»å‡º
- **ç»å¯¹è¶…æ—¶**: 24å°æ—¶å¼ºåˆ¶é‡æ–°è®¤è¯
- **å®‰å…¨ Cookie**: HttpOnly + SameSite + Secure å±æ€§

### é˜²æŠ¤æœºåˆ¶
- **ç™»å½•é™æµ**: 10åˆ†é’Ÿå†…å¤±è´¥5æ¬¡è§¦å‘é™æµ
- **å¯†ç ç­–ç•¥**: æœåŠ¡ç«¯å¼ºåˆ¶éªŒè¯ + å®¢æˆ·ç«¯å‹å¥½æç¤º
- **é”™è¯¯å¤„ç†**: ç»Ÿä¸€é”™è¯¯å“åº”ï¼Œé¿å…ä¿¡æ¯æ³„æ¼

### å®¡è®¡ä¸ç›‘æ§
- **å®æ—¶å®¡è®¡**: æ‰€æœ‰å®‰å…¨äº‹ä»¶å®æ—¶è®°å½•
- **ç®¡ç†å‘˜ç›‘æ§**: ä¸“ç”¨ç®¡ç†ç•Œé¢æŸ¥çœ‹ç³»ç»ŸçŠ¶æ€
- **å“ˆå¸Œé“¾ä¿æŠ¤**: ç¡®ä¿å®¡è®¡æ—¥å¿—å®Œæ•´æ€§

## ğŸ“¦ å®‰è£…ä¸è¿è¡Œ

### ç¯å¢ƒè¦æ±‚
- Node.js 18+
- npm/yarn/pnpm

### ç¯å¢ƒå˜é‡é…ç½®
```bash
# Supabase é…ç½®
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key
```

### å®‰è£…ä¾èµ–
```bash
cd shi-guang-ji
npm install
```

### æ•°æ®åº“è¿ç§»
åœ¨ Supabase SQL Editor ä¸­æ‰§è¡Œä»¥ä¸‹è„šæœ¬ï¼š

```sql
-- å¯ç”¨æ‰©å±•
create extension if not exists pgcrypto;

-- åˆ›å»º is_admin() å‡½æ•°
create or replace function public.is_admin()
returns boolean as $$
  select coalesce((auth.jwt() -> 'app_metadata' ->> 'role') = 'admin', false);
$$ language sql stable security definer;

-- åˆ›å»ºå®¡è®¡æ—¥å¿—è¡¨ï¼ˆå®Œæ•´è„šæœ¬è§é¡¹ç›®æ–‡æ¡£ï¼‰
-- ... (è¯¦ç»† SQL è§ä¸Šæ–‡æä¾›çš„ä¸€é”®è„šæœ¬)
```

### å¯åŠ¨å¼€å‘æœåŠ¡å™¨
```bash
npm run dev
```

### è®¾ç½®ç®¡ç†å‘˜
1. åœ¨ Supabase Dashboard â†’ Authentication â†’ Users
2. ç¼–è¾‘ç”¨æˆ·çš„ app_metadata: `{"role":"admin"}`
3. é‡æ–°ç™»å½•ç”Ÿæ•ˆ

## ğŸ“ é¡¹ç›®ç»“æ„

```
shi-guang-ji/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ (admin)/admin/          # ç®¡ç†å‘˜ç•Œé¢
â”‚   â”‚   â”œâ”€â”€ (auth)/                 # è®¤è¯é¡µé¢
â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”‚   â”œâ”€â”€ admin/              # ç®¡ç†å‘˜ API
â”‚   â”‚   â”‚   â”œâ”€â”€ auth/               # è®¤è¯ API
â”‚   â”‚   â”‚   â””â”€â”€ security/           # å®‰å…¨ API
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â””â”€â”€ security/               # å®‰å…¨å·¥å…·åº“
â”‚   â”œâ”€â”€ stores/                     # çŠ¶æ€ç®¡ç†
â”‚   â””â”€â”€ middleware.ts               # ä¼šè¯ä¸­é—´ä»¶
â”œâ”€â”€ docs/6A_AUTH/                   # å®‰å…¨æ¡†æ¶æ–‡æ¡£
â””â”€â”€ supabase/migrations/            # æ•°æ®åº“è¿ç§»
```

## ğŸ”§ æ ¸å¿ƒåŠŸèƒ½

### ç”¨æˆ·åŠŸèƒ½
- âœ… å®‰å…¨æ³¨å†Œ/ç™»å½•
- âœ… ä¸ªäººæ—¥è®°ç®¡ç†
- âœ… åª’ä½“æ–‡ä»¶ä¸Šä¼ 
- âœ… æ ‡ç­¾ç³»ç»Ÿ
- âœ… æ‰“å¡åŠŸèƒ½

### ç®¡ç†åŠŸèƒ½
- âœ… ç”¨æˆ·ç®¡ç†
- âœ… è§’è‰²åˆ‡æ¢
- âœ… å®¡è®¡æ—¥å¿—æŸ¥çœ‹
- âœ… å®‰å…¨ç›‘æ§

### å®‰å…¨åŠŸèƒ½
- âœ… å¼ºå¯†ç ç­–ç•¥
- âœ… ç™»å½•é™æµ
- âœ… ä¼šè¯è¶…æ—¶
- âœ… å®¡è®¡æ—¥å¿—
- âœ… æƒé™æ§åˆ¶

## ğŸ“ å¼€å‘è¯´æ˜

### å®‰å…¨å¼€å‘åŸåˆ™
1. **æœ€å°æƒé™åŸåˆ™**: ç”¨æˆ·ä»…èƒ½è®¿é—®å¿…è¦èµ„æº
2. **æ·±åº¦é˜²å¾¡**: å¤šå±‚å®‰å…¨æ§åˆ¶
3. **å®¡è®¡ä¼˜å…ˆ**: æ‰€æœ‰å…³é”®æ“ä½œå¿…é¡»å®¡è®¡
4. **é”™è¯¯å®‰å…¨**: å¤±è´¥æ—¶é»˜è®¤æ‹’ç»è®¿é—®

### API å®‰å…¨è§„èŒƒ
- æ‰€æœ‰ç®¡ç†å‘˜ API éœ€éªŒè¯ `is_admin()`
- æ•æ„Ÿæ“ä½œä½¿ç”¨ Service Role Key
- ç»Ÿä¸€é”™è¯¯å“åº”æ ¼å¼
- å®Œæ•´çš„å®¡è®¡æ—¥å¿—è®°å½•

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤æ›´æ”¹
4. æ¨é€åˆ°åˆ†æ”¯
5. åˆ›å»º Pull Request

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸ™ è‡´è°¢

- [Next.js](https://nextjs.org/) - React æ¡†æ¶
- [Supabase](https://supabase.com/) - åç«¯å³æœåŠ¡
- [Tailwind CSS](https://tailwindcss.com/) - CSS æ¡†æ¶
